\documentclass{article}

\usepackage[margin=1in]{geometry}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{float}
\usepackage{biblatex}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{color}
\usepackage{multicol}
%\usepackage{biblatex}


\author{Carl Schiller, 9705266436}
\title{Final Project, SI1336}


\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{mymauve}{rgb}{0.58,0,0.82}
\lstset{
  backgroundcolor=\color{white},   % choose the background color; you must add \usepackage{color} or \usepackage{xcolor}; should come as last argument
  basicstyle=\footnotesize,        % the size of the fonts that are used for the code
  breakatwhitespace=false,         % sets if automatic breaks should only happen at whitespace
  breaklines=true,                 % sets automatic line breaking
  captionpos=b,                    % sets the caption-position to bottom
  commentstyle=\color{mygreen},    % comment style
  deletekeywords={...},            % if you want to delete keywords from the given language
  escapeinside={\%*}{*)},          % if you want to add LaTeX within your code
  extendedchars=true,              % lets you use non-ASCII characters; for 8-bits encodings only, does not work with UTF-8
  frame=single,	                   % adds a frame around the code
  keepspaces=true,                 % keeps spaces in text, useful for keeping indentation of code (possibly needs columns=flexible)
  keywordstyle=\color{blue},       % keyword style
  language=C++,                 % the language of the code
  morekeywords={*,...},            % if you want to add more keywords to the set
  numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
  numbersep=5pt,                   % how far the line-numbers are from the code
  numberstyle=\tiny\color{mygray}, % the style that is used for the line-numbers
  rulecolor=\color{black},         % if not set, the frame-color may be changed on line-breaks within not-black text (e.g. comments (green here))
  showspaces=false,                % show spaces everywhere adding particular underscores; it overrides 'showstringspaces'
  showstringspaces=false,          % underline spaces within strings only
  showtabs=false,                  % show tabs within strings adding particular underscores
  stepnumber=2,                    % the step between two line-numbers. If it's 1, each line will be numbered
  stringstyle=\color{mymauve},     % string literal style
  tabsize=2,	                   % sets default tabsize to 2 spaces
  title=\lstname                   % show the filename of files included with \lstinputlisting; also try caption instead of title
}

\bibliography{report.bib}

\begin{document}
\maketitle

\section*{Abstract}

\tableofcontents

\newpage

\section{Introduction}
  \subsection{Problem formulation}
    This project is intended to simulate the traffic flow effect of a \textit{time fixed ramp
    meter} a freeway
    on-ramp in Roslags NÃ¤sby trafikplats, Sweden. A \textit{ramp meter} is a device that
    manages the flow of traffic onto the freeway, an example of a \textit{ramp meter} can be seen in figure \ref{pic:ramp}.
    More specifically, a \textit{time fixed ramp
    meter} that only allow one car per green signal period will be examined. There are also
    more active variants of \textit{ramp meters} which measure gaps in the traffic on the freeway
    to determine when to release vehicles, but this is beyond the scope of this project.
    Ramp metering systems have successfuly been proven to decrease congestion and
    reduce travel time on freeways.
    ~\cite{u.s._department_of_transportation_federal_highway_administration_ramp_nodate}
    \begin{figure}
      \includegraphics[width=\linewidth]{"ramp meter"}
      \caption{A typical ramp meter, image courtesy of \cite{patriarca12_english:_2008}}
      \label{pic:ramp}
    \end{figure}
  \subsection{Complex systems}
    Traffic flow is a typical example of a complex system. As described in \textit{An Introduction to Computer Simulation Methods Third Edition (revised)},
    traffic flow can be simulated by modelling the system as a \textit{Cellular Automaton}. A \textit{Cellular Automaton} is a
    grid lattice which changes state on each tick based on rules and the current configuration of the lattice. \cite{gould_introduction_nodate}
\section{Method}
  \textit{Cellular Automata} was determined to not be satisfactory when trying to model the flow of the freeway.
  This is because lane change and collision detection worked poorly on a grid lattice in two dimensions. Another
  approach was considered instead.

  \subsection{Graphs}
  \begin{multicols}{2}
    In order to model the road with several lanes, a \textit{directed graph} was
    implemented with blocks of vertices as lanes, with directed edges as paths
    for the cars to drive. In other terms, cars drive on ''rails'' and can
    only change lanes on specified vertices, as can be seen in figure \ref{pic:graph}. \cite{noauthor_gerichteter_2018}

    When using a \textit{directed graph} instead of a grid lattice, collision avoidance becomes a lot easier
    to implement. Time complexity also decreases, which improves simulation performance.
    The collision avoidance method inmplemented is $\mathcal{O}(n\cdot m^{2})$, where $n$ is the amount of cars and $m$ is the
    search area. The grid lattice as previously metioned had dimensions 550x600, which was replaced
    by a graph with approximately 140 edges which improved performance by approximately
    2000 times (if the whole system is searched for potential obstructions i.e. other cars).

    \vfill\null
    \columnbreak

    \begin{figure}[H]
      \begin{center}
        \includegraphics[width=0.8\linewidth]{"pic2"}
        \caption{Setup of road with vertices and edges.}
        \label{pic:graph}
      \end{center}
    \end{figure}
  \end{multicols}

  \subsection{Discretization}
    In contrast to \textit{Cellular Automata}
    there is no grid discretization, and thus the cars run on continuous ''tracks''.
    The distance traveled by each car is determined by the individual car's speed and
    the system wide time step size,
    which has been capped at $1/60$ seconds because of rendering considerations.
    Another benefit from the \textit{directed graph} implementation is that
    the directions of the cars is not required as a parameter. All that is needed in
    order to simulate a car is the speed and the distance
    to the next vertex as well as knowing which vertex the car originated from.
    When stepping in time the distance traveled is subtracted from the distance to the next vertex, and
    when the car has reached the next vertex a new target vertex is selected.

    Cars make decisions independently according to simple rules, and generates
    a complex behavior when interacting with each other i.e. braking or changing lanes.

  \subsection{Graphics rendering}
    When tweaking parameters involved in the cars' descision making, it is hard to
    get an overview of how each parameter influences the system wide behavior of the
    traffic. Thus a lot of effort has been spent on developing a graphical interface
    that shows how the traffic flows in the given configuration of parameters.
    An example of a test run is shown in the link below.
\section{Result}

\section{Discussion}

\printbibliography
\pagebreak
\appendix

\section{Header files}
  \subsection{cars.h}
    \lstinputlisting[language=C++]{../highway/headers/car.h}
  \subsection{road.h}
    \lstinputlisting[language=C++]{../highway/headers/road.h}
  \subsection{roadnode.h}
    \lstinputlisting[language=C++]{../highway/headers/roadnode.h}
  \subsection{roadsegment.h}
    \lstinputlisting[language=C++]{../highway/headers/roadsegment.h}
  \subsection{simulation.h}
    \lstinputlisting[language=C++]{../highway/headers/simulation.h}
  \subsection{traffic.h}
    \lstinputlisting[language=C++]{../highway/headers/traffic.h}
  \subsection{unittests.h}
    \lstinputlisting[language=C++]{../highway/headers/unittests.h}
  \subsection{util.h}
    \lstinputlisting[language=C++]{../highway/headers/util.h}
\section{Source files}
  \subsection{cars.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/car.cpp}
  \subsection{main.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/main.cpp}
  \subsection{road.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/road.cpp}
  \subsection{roadnode.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/roadnode.cpp}
  \subsection{roadsegment.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/roadsegment.cpp}
  \subsection{simulation.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/simulation.cpp}
  \subsection{traffic.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/traffic.cpp}
  \subsection{unittests.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/unittests.cpp}
  \subsection{util.cpp}
    \lstinputlisting[language=C++]{../highway/cppfiles/util.cpp}

\end{document}
